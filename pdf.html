<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FaceParty</title>
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background-color: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .header { text-align: center; margin-bottom: 20px; }
        .logo { width: 150px; }
        .content-block { background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .search-bar { width: 100%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        .button { background-color: #ff3366; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; width: 100%; margin-bottom: 10px; }
        .button:hover { background-color: #e62e5c; }
        .profile-pic, .upload-pic, .person-pic { width: 150px; height: 150px; background-size: cover; background-position: center; border-radius: 50%; margin: 0 auto 20px; cursor: pointer; }
        .upload-pic { background: #ccc; display: flex; align-items: center; justify-content: center; text-align: center; }
        .club-image { width: 100%; height: 200px; background-size: cover; border-radius: 10px; margin-bottom: 20px; }
        .filters { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .filters select { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
        .list-item:hover { background-color: #f9f9f9; }
        .nav-button { background-color: #007bff; color: white; padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer; }
        .nav-button:hover { background-color: #0056b3; }
        .chat-section { position: relative; }
        .chat-header { display: flex; align-items: center; gap: 10px; }
        .chat-message { padding: 10px; background: #f1f1f1; border-radius: 5px; margin-bottom: 10px; }
        .chat-input { width: 100%; height: 60px; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; resize: none; }
        .home-button { position: fixed; bottom: 20px; right: 20px; background-color: #ff3366; color: white; padding: 15px; border-radius: 50%; border: none; cursor: pointer; font-size: 20px; }
        .home-button:hover { background-color: #e62e5c; }
        .footer { text-align: center; color: #666; margin-top: 20px; }
        .facelike-sent { background-color: #28a745; }
        .facelike-sent:hover { background-color: #218838; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Page de connexion/inscription -->
        <div id="photo-login" class="page active">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="content-block">
                <h3>Connexion</h3>
                <input type="email" id="login-email" class="search-bar" placeholder="E-mail">
                <input type="password" id="login-password" class="search-bar" placeholder="Mot de passe">
                <button class="button" onclick="login()">Se connecter</button>
                <button class="button" onclick="showForgotPasswordForm()">Mot de passe oublié ?</button>
            </div>
            <div id="forgot-password-form" class="content-block" style="display: none;">
                <h3>Récupérer le mot de passe</h3>
                <input type="email" id="forgot-email" class="search-bar" placeholder="Votre e-mail">
                <button class="button" onclick="forgotPassword()">Envoyer un lien de réinitialisation</button>
            </div>
            <div id="reset-password-form" class="content-block" style="display: none;">
                <h3>Réinitialiser le mot de passe</h3>
                <input type="email" id="reset-email" class="search-bar" placeholder="Votre e-mail" readonly>
                <input type="password" id="reset-password" class="search-bar" placeholder="Nouveau mot de passe">
                <button class="button" onclick="resetPassword()">Réinitialiser</button>
            </div>
            <div class="content-block">
                <h3>Inscription</h3>
                <input type="text" id="signup-nom" class="search-bar" placeholder="Nom">
                <input type="email" id="signup-email" class="search-bar" placeholder="E-mail">
                <input type="text" id="signup-prenom" class="search-bar" placeholder="Prénom">
                <input type="number" id="signup-age" class="search-bar" placeholder="Âge">
                <input type="text" id="signup-boisson" class="search-bar" placeholder="Boisson préférée">
                <input type="text" id="signup-taille" class="search-bar" placeholder="Taille (ex. 1m80)">
                <select id="signup-eyes" class="search-bar">
                    <option value="">Couleur des yeux</option>
                    <option value="Bleus">Bleus</option>
                    <option value="Verts">Verts</option>
                    <option value="Marrons">Marrons</option>
                    <option value="Gris">Gris</option>
                    <option value="Noisette">Noisette</option>
                    <option value="Ambre">Ambre</option>
                    <option value="Noirs">Noirs</option>
                    <option value="Violets">Violets</option>
                </select>
                <select id="signup-hair" class="search-bar">
                    <option value="">Couleur des cheveux</option>
                    <option value="Brun">Brun</option>
                    <option value="Blond">Blond</option>
                    <option value="Roux">Roux</option>
                    <option value="Châtain">Châtain</option>
                    <option value="Noir">Noir</option>
                    <option value="Gris">Gris</option>
                    <option value="Blanc">Blanc</option>
                    <option value="Auburn">Auburn</option>
                    <option value="Châtain clair">Châtain clair</option>
                    <option value="Châtain foncé">Châtain foncé</option>
                </select>
                <select id="signup-nationality" class="search-bar">
                    <option value="">Nationalité</option>
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albanie">Albanie</option>
                    <!-- Ajouter les 191 autres nationalités de l'ONU ici -->
                </select>
                <input type="password" id="signup-password" class="search-bar" placeholder="Mot de passe">
                <button class="button" onclick="signup()">Créer</button>
            </div>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Page d'accueil -->
        <div id="photo-1" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="profile-pic" id="profile-pic" style="background-image: url('https://via.placeholder.com/150?text=Photo+Utilisateur');" onclick="showPage('photo-2')"></div>
            <button class="button" onclick="showPage('stats-page')">Statistiques</button>
            <button class="button" onclick="showPage('photo-3')">Soirées autour de moi</button>
            <input type="text" id="city-search" class="search-bar" placeholder="Entrez une ville pour trouver des boîtes de nuit">
            <button class="button" onclick="searchNightclubs()">Rechercher des boîtes de nuit</button>
            <input type="text" class="search-bar" id="search-bar" placeholder="Rechercher un lieu festif..." onkeyup="searchPlaces()">
            <div class="content-block" id="places-list"></div>
            <button class="button" onclick="showPage('photo-7')">Messages</button>
            <button class="button" onclick="showPage('photo-6')">Facelikes reçus</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Profil personnel -->
        <div id="photo-2" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="upload-pic" id="upload-pic" onclick="document.getElementById('profile-upload').click()">
                <span>Charger une photo</span>
            </div>
            <input type="file" id="profile-upload" style="display: none;" accept="image/*" onchange="uploadProfilePic(event)">
            <div class="content-block" id="profile-display">
                <h3 id="profile-prenom"></h3>
                <p id="profile-age"></p>
                <p id="profile-boisson"></p>
                <p id="profile-taille"></p>
                <p id="profile-eyes"></p>
                <p id="profile-hair"></p>
                <p id="profile-nationality"></p>
            </div>
            <button class="button" onclick="showEditProfileForm()">Modifier le profil</button>
            <div class="content-block" id="edit-profile-form" style="display: none;">
                <h3>Modifier le profil</h3>
                <input type="email" id="edit-email" class="search-bar" placeholder="Nouvel e-mail">
                <input type="password" id="edit-password" class="search-bar" placeholder="Nouveau mot de passe">
                <input type="text" id="edit-prenom" class="search-bar" placeholder="Prénom">
                <input type="number" id="edit-age" class="search-bar" placeholder="Âge">
                <input type="text" id="edit-boisson" class="search-bar" placeholder="Boisson préférée">
                <input type="text" id="edit-taille" class="search-bar" placeholder="Taille (ex. 1m80)">
                <select id="edit-eyes" class="search-bar">
                    <option value="">Couleur des yeux</option>
                    <option value="Bleus">Bleus</option>
                    <option value="Verts">Verts</option>
                    <option value="Marrons">Marrons</option>
                    <option value="Gris">Gris</option>
                    <option value="Noisette">Noisette</option>
                    <option value="Ambre">Ambre</option>
                    <option value="Noirs">Noirs</option>
                    <option value="Violets">Violets</option>
                </select>
                <select id="edit-hair" class="search-bar">
                    <option value="">Couleur des cheveux</option>
                    <option value="Brun">Brun</option>
                    <option value="Blond">Blond</option>
                    <option value="Roux">Roux</option>
                    <option value="Châtain">Châtain</option>
                    <option value="Noir">Noir</option>
                    <option value="Gris">Gris</option>
                    <option value="Blanc">Blanc</option>
                    <option value="Auburn">Auburn</option>
                    <option value="Châtain clair">Châtain clair</option>
                    <option value="Châtain foncé">Châtain foncé</option>
                </select>
                <select id="edit-nationality" class="search-bar">
                    <option value="">Nationalité</option>
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albanie">Albanie</option>
                    <!-- Ajouter les 191 autres nationalités de l'ONU ici -->
                </select>
                <button class="button" onclick="saveProfile()">Sauvegarder</button>
            </div>
            <button class="button" onclick="showPage('friends-page')">Amis</button>
            <button class="button" onclick="showPage('photo-1')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Détails des soirées -->
        <div id="photo-3" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <input type="text" class="search-bar" id="search-bar-full" placeholder="Rechercher un lieu festif..." onkeyup="searchPlacesFull()">
            <div class="content-block" id="places-list-full"></div>
            <button class="button" onclick="showPage('photo-1')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Détails du lieu -->
        <div id="photo-4" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="club-image" style="background-image: url('https://via.placeholder.com/400x200?text=Fictif+Le+Nocturne+Électro+Chic+Pink/Purple+Neons+Crowd+Strobes');"></div>
            <div class="content-block">
                <p>Note : 4.5/5</p>
                <p>Ambiance musicale : Électro</p>
                <p>Dress code : Chic</p>
                <p>Sélectivité : 10€, Ratio 1:1</p>
                <p>Vidéos : [Simulé - Cliquez pour voir l’ambiance]</p>
                <p>Participants FaceParty : 45</p>
                <p>Amis présents ce soir : 2</p>
                <p>Amis déjà allés : 8</p>
            </div>
            <button class="button" onclick="showPage('photo-5')">Rejoindre</button>
            <button class="button" onclick="showPage('photo-3')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Participants avec filtres -->
        <div id="photo-5" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="filters">
                <select id="filter-preferences" onchange="applyFilters()">
                    <option value="all">Préférences (Filles/Garçons/Tous)</option>
                    <option value="femmes">Filles</option>
                    <option value="hommes">Garçons</option>
                </select>
                <select id="filter-age" onchange="applyFilters()">
                    <option value="all">Âge</option>
                    <option value="18-25">18-25</option>
                    <option value="26-30">26-30</option>
                </select>
                <select id="filter-height" onchange="applyFilters()">
                    <option value="all">Taille</option>
                    <option value="petit">1m60-1m70</option>
                    <option value="grand">1m70+</option>
                </select>
                <select id="filter-eyes" onchange="applyFilters()">
                    <option value="all">Yeux</option>
                    <option value="Bleus">Bleus</option>
                    <option value="Verts">Verts</option>
                    <option value="Marrons">Marrons</option>
                    <option value="Gris">Gris</option>
                </select>
                <select id="filter-hair" onchange="applyFilters()">
                    <option value="all">Cheveux</option>
                    <option value="Brun">Brun</option>
                    <option value="Blond">Blond</option>
                    <option value="Roux">Roux</option>
                    <option value="Châtain">Châtain</option>
                </select>
                <select id="filter-nationality" onchange="applyFilters()">
                    <option value="all">Origine</option>
                    <option value="Afghanistan">Afghanistan</option>
                    <option value="Albanie">Albanie</option>
                    <!-- Ajouter les 191 autres nationalités de l'ONU ici -->
                </select>
            </div>
            <div class="content-block" id="participants-list"></div>
            <button class="button" onclick="showPage('photo-4')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Profil d'une personne -->
        <div id="person-profile" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="person-pic" id="person-pic" style="background-image: url('https://via.placeholder.com/150?text=Fictif+Utilisateur');"></div>
            <div class="content-block">
                <h3 id="person-name"></h3>
                <p id="person-age"></p>
                <p id="person-height"></p>
                <p id="person-eyes"></p>
                <p id="person-hair"></p>
                <p id="person-nationality"></p>
                <p id="person-boisson"></p>
            </div>
            <button class="button" id="facelike-button" onclick="sendFacelikeFromProfile()">Facelike</button>
            <button class="button" onclick="showPage('photo-5')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Facelikes reçus -->
        <div id="photo-6" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="content-block" id="received-facelikes"></div>
            <button class="button" onclick="showPage('photo-1')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Messages -->
        <div id="photo-7" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="content-block" id="chat-list"></div>
            <div class="content-block chat-section" id="chat-section" style="display: none;">
                <div class="chat-header">
                    <button class="button back-button" onclick="displayChatList()">Retour aux conversations</button>
                    <h3 id="chat-partner"></h3>
                </div>
                <div id="chat-content"></div>
                <textarea class="chat-input" id="chat-input" placeholder="Tapez votre message..."></textarea>
                <button class="button" onclick="sendMessage()">Envoyer</button>
                <button class="button" id="keep-as-friend-button" onclick="requestKeepAsFriend()">Garder en ami</button>
            </div>
            <button class="button" onclick="showPage('photo-1')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Page Statistiques -->
        <div id="stats-page" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="content-block">
                <p>Facelikes envoyés : 0</p>
                <p>Facelikes reçus : 0</p>
                <p>Facematchs : 0</p>
            </div>
            <button class="button" onclick="showPage('photo-1')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Page Amis -->
        <div id="friends-page" class="page">
            <div class="header">
                <img src="https://i.imgur.com/ZuiLCGZ.jpeg" alt="FaceParty Logo" class="logo">
            </div>
            <div class="content-block" id="friends-list"></div>
            <button class="button" onclick="showPage('photo-2')">Retour</button>
            <div class="footer">
                <p>© FaceParty 2025</p>
            </div>
        </div>

        <!-- Bouton central fixe -->
        <button class="home-button" onclick="showPage('photo-1')">🏠</button>
    </div>

    <script>
        let currentUser = null;
        let currentChatPartner = null;
        let pendingSignUpData = null;
        let participants = [];

        function signup() {
            const nom = document.getElementById('signup-nom').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const prenom = document.getElementById('signup-prenom').value.trim();
            const age = document.getElementById('signup-age').value.trim();
            const boisson = document.getElementById('signup-boisson').value.trim();
            const taille = document.getElementById('signup-taille').value.trim();
            const eyes = document.getElementById('signup-eyes').value;
            const hair = document.getElementById('signup-hair').value;
            const nationality = document.getElementById('signup-nationality').value;
            const password = document.getElementById('signup-password').value.trim();

            if (!nom || !email || !prenom || !age || !boisson || !taille || !eyes || !hair || !nationality || !password) {
                alert('Veuillez remplir tous les champs pour vous inscrire.');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[email]) {
                alert('Cet e-mail est déjà utilisé.');
                return;
            }

            pendingSignUpData = { nom, email, prenom, age, boisson, taille, eyes, hair, nationality, password };
            alert(`Un lien de vérification a été envoyé à ${email}. Vérifiez votre boîte mail et cliquez sur le lien pour confirmer. (Simulation : Attendez 3 secondes)`);
            setTimeout(() => {
                const verified = confirm('Avez-vous cliqué sur le lien dans votre e-mail ?');
                if (verified) {
                    confirmSignUp();
                } else {
                    alert('Inscription annulée.');
                }
            }, 3000);
        }

        function confirmSignUp() {
            if (!pendingSignUpData) return;

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const { nom, email, prenom, age, boisson, taille, eyes, hair, nationality, password } = pendingSignUpData;

            users[email] = {
                nom, email, password,
                profile: { prenom, age, boisson, taille, eyes, hair, nationality, profilePic: 'https://via.placeholder.com/150?text=Photo+Utilisateur' },
                messages: {},
                friends: [],
                facelikes: { sent: [], received: [] },
                friendRequests: {}
            };
            localStorage.setItem('users', JSON.stringify(users));

            participants.push({
                name: prenom,
                age,
                height: taille,
                eyes,
                hair,
                nationality,
                gender: Math.random() > 0.5 ? 'femmes' : 'hommes',
                pic: 'https://via.placeholder.com/150?text=' + prenom,
                boisson
            });

            currentUser = email;
            pendingSignUpData = null;
            showPage('photo-1');
            loadProfile();
            displayReceivedFacelikes();
        }

        function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[email] || users[email].password !== password) {
                alert('E-mail ou mot de passe incorrect.');
                return;
            }
            currentUser = email;
            showPage('photo-1');
            loadProfile();
            displayReceivedFacelikes();
        }

        function showForgotPasswordForm() {
            document.getElementById('forgot-password-form').style.display = 'block';
        }

        function forgotPassword() {
            const email = document.getElementById('forgot-email').value.trim();
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (!users[email]) {
                alert('Cet e-mail n\'existe pas.');
                return;
            }
            alert(`Un lien de réinitialisation a été envoyé à ${email}. (Simulation : Attendez 3 secondes)`);
            setTimeout(() => {
                const verified = confirm('Avez-vous cliqué sur le lien de réinitialisation dans votre e-mail ?');
                if (verified) {
                    document.getElementById('reset-password-form').style.display = 'block';
                    document.getElementById('reset-email').value = email;
                } else {
                    alert('Réinitialisation annulée.');
                }
            }, 3000);
        }

        function resetPassword() {
            const email = document.getElementById('reset-email').value.trim();
            const newPassword = document.getElementById('reset-password').value.trim();
            if (!newPassword) {
                alert('Veuillez entrer un nouveau mot de passe.');
                return;
            }
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            users[email].password = newPassword;
            localStorage.setItem('users', JSON.stringify(users));
            alert('Mot de passe réinitialisé.');
            document.getElementById('reset-password-form').style.display = 'none';
            document.getElementById('login-email').value = email;
        }

        function loadProfile() {
            if (currentUser) {
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                const user = users[currentUser];
                document.getElementById('profile-prenom').textContent = user.profile.prenom;
                document.getElementById('profile-age').textContent = `Âge : ${user.profile.age}`;
                document.getElementById('profile-boisson').textContent = `Boisson préférée : ${user.profile.boisson}`;
                document.getElementById('profile-taille').textContent = `Taille : ${user.profile.taille}`;
                document.getElementById('profile-eyes').textContent = `Couleur des yeux : ${user.profile.eyes}`;
                document.getElementById('profile-hair').textContent = `Couleur des cheveux : ${user.profile.hair}`;
                document.getElementById('profile-nationality').textContent = `Nationalité : ${user.profile.nationality}`;
                if (user.profile.profilePic) {
                    document.getElementById('profile-pic').style.backgroundImage = `url(${user.profile.profilePic})`;
                    document.getElementById('upload-pic').style.display = user.profile.profilePic === 'https://via.placeholder.com/150?text=Photo+Utilisateur' ? 'block' : 'none';
                }
            }
        }

        function showEditProfileForm() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const user = users[currentUser];
            document.getElementById('edit-email').value = user.email;
            document.getElementById('edit-prenom').value = user.profile.prenom;
            document.getElementById('edit-age').value = user.profile.age;
            document.getElementById('edit-boisson').value = user.profile.boisson;
            document.getElementById('edit-taille').value = user.profile.taille;
            document.getElementById('edit-eyes').value = user.profile.eyes;
            document.getElementById('edit-hair').value = user.profile.hair;
            document.getElementById('edit-nationality').value = user.profile.nationality;
            document.getElementById('profile-display').style.display = 'none';
            document.getElementById('edit-profile-form').style.display = 'block';
        }

        function saveProfile() {
            const newEmail = document.getElementById('edit-email').value.trim();
            const newPassword = document.getElementById('edit-password').value.trim();
            const prenom = document.getElementById('edit-prenom').value.trim();
            const age = document.getElementById('edit-age').value.trim();
            const boisson = document.getElementById('edit-boisson').value.trim();
            const taille = document.getElementById('edit-taille').value.trim();
            const eyes = document.getElementById('edit-eyes').value;
            const hair = document.getElementById('edit-hair').value;
            const nationality = document.getElementById('edit-nationality').value;

            if (!prenom || !age || !boisson || !taille || !eyes || !hair || !nationality) {
                alert('Veuillez remplir tous les champs.');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const oldEmail = currentUser;

            if (newEmail && newEmail !== oldEmail) {
                if (users[newEmail]) {
                    alert('Cet e-mail est déjà utilisé.');
                    return;
                }
                users[newEmail] = users[oldEmail];
                delete users[oldEmail];
                currentUser = newEmail;
            }

            if (newPassword) users[currentUser].password = newPassword;
            users[currentUser].profile = { prenom, age, boisson, taille, eyes, hair, nationality, profilePic: users[currentUser].profile.profilePic };

            const participantIndex = participants.findIndex(p => p.name === users[oldEmail]?.profile.prenom);
            if (participantIndex !== -1) {
                participants[participantIndex] = {
                    name: prenom,
                    age,
                    height: taille,
                    eyes,
                    hair,
                    nationality,
                    gender: participants[participantIndex].gender,
                    pic: participants[participantIndex].pic,
                    boisson
                };
            }

            localStorage.setItem('users', JSON.stringify(users));
            document.getElementById('profile-display').style.display = 'block';
            document.getElementById('edit-profile-form').style.display = 'none';
            loadProfile();
        }

        function showPage(pageId) {
            if (!currentUser && pageId !== 'photo-login') {
                showPage('photo-login');
                return;
            }
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if (pageId === 'photo-7') displayChatList();
            else if (pageId === 'photo-2') loadProfile();
            else if (pageId === 'photo-6') displayReceivedFacelikes();
            else if (pageId === 'photo-5') applyFilters();
            else if (pageId === 'friends-page') displayFriendsList();
        }

        function uploadProfilePic(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const profilePicUrl = e.target.result;
                    const users = JSON.parse(localStorage.getItem('users') || '{}');
                    users[currentUser].profile.profilePic = profilePicUrl;
                    localStorage.setItem('users', JSON.stringify(users));
                    const participantIndex = participants.findIndex(p => p.name === users[currentUser].profile.prenom);
                    if (participantIndex !== -1) participants[participantIndex].pic = profilePicUrl;
                    loadProfile();
                };
                reader.readAsDataURL(file);
            }
        }

        function requestKeepAsFriend() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            users[currentUser].friends.push(currentChatPartner);
            users[currentChatPartner].friends.push(currentUser);
            localStorage.setItem('users', JSON.stringify(users));
            document.getElementById('keep-as-friend-button').style.display = 'none';
        }

        function sendMessage() {
            const message = document.getElementById('chat-input').value.trim();
            if (message && currentUser && currentChatPartner) {
                const chatContent = document.getElementById('chat-content');
                const newMessage = document.createElement('div');
                newMessage.className = 'chat-message';
                newMessage.textContent = `Vous (${new Date().toLocaleTimeString()}) : ${message}`;
                chatContent.appendChild(newMessage);
                document.getElementById('chat-input').value = '';

                const users = JSON.parse(localStorage.getItem('users') || '{}');
                users[currentUser].messages[currentChatPartner] = users[currentUser].messages[currentChatPartner] || [];
                users[currentUser].messages[currentChatPartner].push({ sender: 'you', text: message, time: new Date().toLocaleTimeString() });
                users[currentChatPartner].messages[currentUser] = users[currentChatPartner].messages[currentUser] || [];
                users[currentChatPartner].messages[currentUser].push({ sender: currentChatPartner, text: message, time: new Date().toLocaleTimeString() });
                localStorage.setItem('users', JSON.stringify(users));
            }
        }

        function displayChatList() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const chatList = document.getElementById('chat-list');
            const chatSection = document.getElementById('chat-section');
            chatList.innerHTML = '';
            chatList.style.display = 'block';
            chatSection.style.display = 'none';

            const conversations = Object.keys(users[currentUser].messages);
            if (conversations.length === 0) {
                chatList.innerHTML = '<p>Aucune conversation pour le moment.</p>';
            } else {
                conversations.forEach(partner => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `<span>${partner}</span>`;
                    item.onclick = () => {
                        currentChatPartner = partner;
                        chatList.style.display = 'none';
                        chatSection.style.display = 'block';
                        loadChat();
                    };
                    chatList.appendChild(item);
                });
            }
        }

        function loadChat() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const chatContent = document.getElementById('chat-content');
            chatContent.innerHTML = '';
            const messages = users[currentUser].messages[currentChatPartner] || [];
            messages.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.textContent = `${msg.sender === 'you' ? 'Vous' : currentChatPartner} (${msg.time}) : ${msg.text}`;
                chatContent.appendChild(messageDiv);
            });
            document.getElementById('chat-partner').textContent = `Chat avec ${currentChatPartner}`;
        }

        function showPersonProfile(person) {
            const profile = participants.find(p => p.name === person);
            if (profile) {
                document.getElementById('person-name').textContent = profile.name;
                document.getElementById('person-age').textContent = `${profile.age} ans`;
                document.getElementById('person-height').textContent = `Taille : ${profile.height}`;
                document.getElementById('person-eyes').textContent = `Yeux : ${profile.eyes}`;
                document.getElementById('person-hair').textContent = `Cheveux : ${profile.hair}`;
                document.getElementById('person-nationality').textContent = `Nationalité : ${profile.nationality}`;
                document.getElementById('person-boisson').textContent = `Boisson préférée : ${profile.boisson}`;
                document.getElementById('person-pic').style.backgroundImage = `url(${profile.pic})`;
                const facelikeButton = document.getElementById('facelike-button');
                const users = JSON.parse(localStorage.getItem('users') || '{}');
                facelikeButton.textContent = users[currentUser].facelikes.sent.includes(profile.name) ? 'Retirer Facelike' : 'Facelike';
                facelikeButton.classList.toggle('facelike-sent', users[currentUser].facelikes.sent.includes(profile.name));
                showPage('person-profile');
            }
        }

        function sendFacelike(person, event) {
            event.stopPropagation();
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const button = event.target;
            if (users[currentUser].facelikes.sent.includes(person)) {
                users[currentUser].facelikes.sent = users[currentUser].facelikes.sent.filter(p => p !== person);
                users[person].facelikes.received = users[person].facelikes.received.filter(p => p !== currentUser);
                button.textContent = 'Facelike';
                button.classList.remove('facelike-sent');
            } else {
                users[currentUser].facelikes.sent.push(person);
                users[person].facelikes.received.push(currentUser);
                button.textContent = 'Retirer Facelike';
                button.classList.add('facelike-sent');
            }
            localStorage.setItem('users', JSON.stringify(users));
            displayReceivedFacelikes();
        }

        function sendFacelikeFromProfile() {
            const personName = document.getElementById('person-name').textContent;
            const facelikeButton = document.getElementById('facelike-button');
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[currentUser].facelikes.sent.includes(personName)) {
                users[currentUser].facelikes.sent = users[currentUser].facelikes.sent.filter(p => p !== personName);
                users[personName].facelikes.received = users[personName].facelikes.received.filter(p => p !== currentUser);
                facelikeButton.textContent = 'Facelike';
                facelikeButton.classList.remove('facelike-sent');
            } else {
                users[currentUser].facelikes.sent.push(personName);
                users[personName].facelikes.received.push(currentUser);
                facelikeButton.textContent = 'Retirer Facelike';
                facelikeButton.classList.add('facelike-sent');
            }
            localStorage.setItem('users', JSON.stringify(users));
        }

        function acceptFacelike(person) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            users[currentUser].facelikes.received = users[currentUser].facelikes.received.filter(p => p !== person);
            localStorage.setItem('users', JSON.stringify(users));
            currentChatPartner = person;
            users[currentUser].messages[person] = users[currentUser].messages[person] || [];
            users[currentUser].messages[person].push({ sender: 'you', text: 'Salut, ravi de te matcher !', time: new Date().toLocaleTimeString() });
            users[person].messages[currentUser] = users[person].messages[currentUser] || [];
            users[person].messages[currentUser].push({ sender: 'you', text: 'Salut, ravi de te matcher !', time: new Date().toLocaleTimeString() });
            localStorage.setItem('users', JSON.stringify(users));
            displayReceivedFacelikes();
            showPage('photo-7');
            loadChat();
        }

        function refuseFacelike(person) {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            users[currentUser].facelikes.received = users[currentUser].facelikes.received.filter(p => p !== person);
            localStorage.setItem('users', JSON.stringify(users));
            displayReceivedFacelikes();
        }

        function displayReceivedFacelikes() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const receivedFacelikes = users[currentUser].facelikes.received || [];
            const facelikesDiv = document.getElementById('received-facelikes');
            facelikesDiv.innerHTML = '';
            if (receivedFacelikes.length === 0) {
                facelikesDiv.innerHTML = '<p>Aucun facelike reçu.</p>';
            } else {
                receivedFacelikes.forEach(person => {
                    const profile = participants.find(p => p.name === person);
                    if (profile) {
                        const item = document.createElement('div');
                        item.className = 'list-item';
                        item.innerHTML = `
                            <span onclick="showPersonProfile('${profile.name}')">${profile.name} vous a faceliké</span>
                            <div>
                                <button class="nav-button" onclick="acceptFacelike('${profile.name}')">Accepter</button>
                                <button class="nav-button" onclick="refuseFacelike('${profile.name}')">Refuser</button>
                            </div>
                        `;
                        facelikesDiv.appendChild(item);
                    }
                });
            }
        }

        function displayFriendsList() {
            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const friendsList = document.getElementById('friends-list');
            friendsList.innerHTML = '';
            const friends = users[currentUser].friends || [];
            if (friends.length === 0) {
                friendsList.innerHTML = '<p>Vous n\'avez pas encore d\'amis.</p>';
            } else {
                friends.forEach(friend => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.innerHTML = `<span onclick="showPersonProfile('${friend}')">${friend}</span>`;
                    friendsList.appendChild(item);
                });
            }
        }

        function applyFilters() {
            const preferences = document.getElementById('filter-preferences').value;
            const ageFilter = document.getElementById('filter-age').value;
            const height = document.getElementById('filter-height').value;
            const eyes = document.getElementById('filter-eyes').value;
            const hair = document.getElementById('filter-hair').value;
            const nationality = document.getElementById('filter-nationality').value;

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            const currentUserProfile = users[currentUser].profile.prenom;

            const filteredParticipants = participants.filter(p => {
                if (p.name === currentUserProfile) return false;
                if (preferences !== 'all' && p.gender !== preferences) return false;
                if (ageFilter !== 'all' && !((ageFilter === '18-25' && p.age >= 18 && p.age <= 25) || (ageFilter === '26-30' && p.age >= 26 && p.age <= 30))) return false;
                if (height !== 'all' && !((height === 'petit' && p.height.startsWith('1m6')) || (height === 'grand' && p.height.startsWith('1m7') || p.height.startsWith('1m8')))) return false;
                if (eyes !== 'all' && p.eyes !== eyes) return false;
                if (hair !== 'all' && p.hair !== hair) return false;
                if (nationality !== 'all' && p.nationality !== nationality) return false;
                return true;
            });

            const participantsList = document.getElementById('participants-list');
            participantsList.innerHTML = '';
            filteredParticipants.forEach(p => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.innerHTML = `
                    <span onclick="showPersonProfile('${p.name}')">${p.name}, ${p.age} ans, ${p.height}, Yeux ${p.eyes}, ${p.hair}, ${p.nationality}</span>
                    <button class="nav-button" onclick="sendFacelike('${p.name}', event)">Facelike</button>
                `;
                participantsList.appendChild(item);
            });
        }

        function searchNightclubs() {
            const city = document.getElementById('city-search').value.trim().toLowerCase();
            if (!city) {
                alert('Veuillez entrer une ville.');
                return;
            }

            const placesList = document.getElementById('places-list');
            placesList.innerHTML = '';

            // Données simulées pour Paris et Roanne
            const nightclubs = {
                paris: [
                    { name: 'L\'ARC', rating: 5.0 },
                    { name: 'Aquarium', rating: 4.99 },
                    { name: 'Le Pulse', rating: 4.8 },
                    { name: 'Le Nocturne', rating: 4.5 }
                ],
                roanne: [
                    { name: 'Le Club 42', rating: 4.2 },
                    { name: 'L\'Eclipse', rating: 4.0 }
                ]
            };

            const cityNightclubs = nightclubs[city] || [];
            if (cityNightclubs.length === 0) {
                placesList.innerHTML = '<p>Aucune boîte de nuit trouvée pour cette ville.</p>';
            } else {
                cityNightclubs.forEach(place => {
                    const item = document.createElement('div');
                    item.className = 'list-item';
                    item.textContent = `${place.name} - ${place.rating}/5`;
                    item.onclick = () => showPage('photo-4');
                    placesList.appendChild(item);
                });
            }
        }

        function searchPlaces() {
            const searchValue = document.getElementById('search-bar').value.toLowerCase();
            const placesList = document.getElementById('places-list');
            placesList.innerHTML = '';
            const places = ['Le Nocturne', 'Le Pulse'].filter(place => place.toLowerCase().includes(searchValue));
            places.forEach(place => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.textContent = place;
                item.onclick = () => showPage('photo-4');
                placesList.appendChild(item);
            });
        }

        function searchPlacesFull() {
            const searchValue = document.getElementById('search-bar-full').value.toLowerCase();
            const placesList = document.getElementById('places-list-full');
            placesList.innerHTML = '';
            const places = ['Le Nocturne', 'Le Pulse'].filter(place => place.toLowerCase().includes(searchValue));
            places.forEach(place => {
                const item = document.createElement('div');
                item.className = 'list-item';
                item.textContent = place;
                item.onclick = () => showPage('photo-4');
                placesList.appendChild(item);
            });
        }

        localStorage.removeItem('users');
        showPage('photo-login');
    </script>
</body>
</html>